<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registrarse - Level-Up</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
<header>
  <nav>
    <a href="../index.html" class="logo">Level-Up</a>
    <ul class="nav-links">
      <li><a href="../index.html">Inicio</a></li>
      <li><a href="productos.html">Productos</a></li>
    </ul>
    <div id="auth-buttons"></div>
  </nav>
</header>

<section class="products-section">
  <div class="container">
    <h2 class="section-title">Crear cuenta</h2>
    <div class="auth-card" style="max-width:720px;">
      <form id="register-form" class="auth-form">
        <div class="form-grid cols-2">
          <div class="field-group">
            <label for="nombre" class="field-label">Nombre</label>
            <input id="nombre" name="nombre" type="text" class="info-input" required>
          </div>
          <div class="field-group">
            <label for="apellido" class="field-label">Apellido</label>
            <input id="apellido" name="apellido" type="text" class="info-input" required>
          </div>
          <div class="field-group" style="grid-column:1/3">
            <label for="email" class="field-label">Correo electr√≥nico</label>
            <input id="email" name="email" type="email" class="info-input" required placeholder="tucorreo@dominio.cl">
            <p class="hint-text">Correos @duocuc.cl obtienen 20% de descuento permanente.</p>
          </div>
          <div class="field-group">
            <label for="password" class="field-label">Contrase√±a</label>
            <input id="password" name="password" type="password" minlength="6" class="info-input" required>
          </div>
          <div class="field-group">
            <label for="edad" class="field-label">Edad</label>
            <input id="edad" name="edad" type="number" min="0" class="info-input" required>
            <p class="hint-text">Debes ser mayor de 18 a√±os.</p>
          </div>
          <div class="field-group" style="grid-column:1/3">
            <label for="referido" class="field-label">C√≥digo de referido (opcional)</label>
            <input id="referido" name="referido" type="text" class="info-input" placeholder="LEVELUP-XXXX">
          </div>
        </div>
        <div class="form-actions">
          <button class="btn-primary" type="submit">Registrarse</button>
          <a class="btn-secondary" href="login.html" style="display:inline-block;text-align:center;line-height:2.3rem">Ya tengo cuenta</a>
        </div>
        <div id="msg" class="hint-text" style="color:#39FF14"></div>
      </form>
    </div>
  </div>
</section>

<script src="../assets/js/auth.js"></script>
<script>
document.addEventListener("DOMContentLoaded", ()=>{
  // Header din√°mico
  const authDiv = document.getElementById('auth-buttons');
  const u = window.GZAuth.currentUser();
  if(u){
    authDiv.innerHTML = `
      <button class="cart-btn" onclick="location.href='carrito.html'">üõí Carrito</button>
      <button class="btn-secondary" id="logout">Salir</button>`;
    document.getElementById('logout').onclick = ()=>{ GZAuth.logout(); location.reload(); };
  }else{
    authDiv.innerHTML = `
      <button class="cart-btn" onclick="location.href='login.html'">Iniciar sesi√≥n</button>
      <button class="btn-secondary" onclick="location.href='register.html'">Registrarse</button>`;
  }

  // Registro
  document.getElementById('register-form').addEventListener('submit', function(e){
    e.preventDefault();
    const form = new FormData(e.target);
    const edad = parseInt(form.get('edad'), 10);
    const msg = document.getElementById('msg');
    if(isNaN(edad) || edad < 18){
      msg.style.color = '#ff6b6b';
      msg.textContent = 'Registro denegado: debes ser mayor de 18.';
      return;
    }
    const ok = window.GZAuth.register({
      nombre: form.get('nombre').trim(),
      apellido: form.get('apellido').trim(),
      email: form.get('email').trim().toLowerCase(),
      password: form.get('password'),
      edad: edad,
      referido: form.get('referido').trim()
    });
    if(!ok.success){
      msg.style.color = '#ff6b6b';
      msg.textContent = ok.message;
    }else{
      msg.style.color = '#39FF14';
      msg.textContent = 'Cuenta creada. Redirigiendo‚Ä¶';
      setTimeout(()=>location.href='login.html', 800);
    }
  });
});
</script>
</body>
</html>